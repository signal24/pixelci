openapi: 3.0.3
info:
  title: OpenAPI
  contact: {}
  license:
    name: MIT
  version: 0.0.1
servers: []
paths:
  /api/session/me:
    get:
      tags:
        - session
      operationId: getSessionGetIdentity
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ISessionResponse"
  /api/session/providers:
    get:
      tags:
        - session
      operationId: getSessionGetProviders
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ISessionProvider"
  /api/session/providers/{id}/login-url:
    get:
      tags:
        - session
      operationId: getSessionGetProviderLoginUrl
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
        - in: query
          name: redirectUri
          schema:
            type: string
          required: true
        - in: query
          name: state
          schema:
            type: string
          required: false
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                required:
                  - url
  /api/session/onboarding-status:
    get:
      tags:
        - session
      operationId: getSessionGetOnboardingStatus
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IOnboardingStatusResponse"
  /api/session/onboarding/vcs-integration:
    post:
      tags:
        - session
      operationId: postSessionCreateOnboardingVcsIntegration
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IOnboardingVcsIntegrationInput"
        required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PickVcsIntegrationEntity"
  /api/session/login:
    post:
      tags:
        - session
      operationId: postSessionLogin
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ISessionLoginRequest"
        required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ISessionLoginResponse"
  /api/apps:
    get:
      tags:
        - apps
      operationId: getAppsIndex
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IAppIndexResponse"
    post:
      tags:
        - apps
      operationId: postAppsCreate
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IAppCreateInput"
        required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IAppIndexResponse"
  /api/apps/{id}:
    get:
      tags:
        - apps
      operationId: getAppsShow
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IAppShowResponse"
    put:
      tags:
        - apps
      operationId: putAppsUpdate
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IAppUpdateInput"
        required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IAppIndexResponse"
    delete:
      tags:
        - apps
      operationId: deleteAppsDelete
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema: {}
  /api/apps/vcs-projects/search:
    get:
      tags:
        - apps
      operationId: getAppsSearchVcsProjects
      parameters:
        - in: query
          name: vcsId
          schema:
            type: string
          required: true
        - in: query
          name: search
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IVcsProject"
  /api/apps/vcs-projects/resolve:
    get:
      tags:
        - apps
      operationId: getAppsResolveVcsProject
      parameters:
        - in: query
          name: vcsId
          schema:
            type: string
          required: true
        - in: query
          name: url
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IVcsProject"
  /api/apps/{appId}/branches:
    get:
      tags:
        - branches
      operationId: getBranchesIndex
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IBranchResponse"
  /api/apps/{appId}/builds:
    get:
      tags:
        - builds
      operationId: getBuildsIndex
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
        - in: query
          name: branchId
          schema:
            type: string
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IBuildResponse"
    post:
      tags:
        - builds
      operationId: postBuildsCreate
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IBuildResponse"
  /api/apps/{appId}/builds/{id}:
    get:
      tags:
        - builds
      operationId: getBuildsGet
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IBuildResponse"
  /api/apps/{appId}/builds/{id}/status:
    get:
      tags:
        - builds
      operationId: getBuildsShow
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IBuildBasicResponse"
  /api/apps/{appId}/builds/{id}/process:
    post:
      tags:
        - builds
      operationId: postBuildsProcess
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                required:
                  - ok
  /api/apps/{appId}/builds/{id}/approve:
    post:
      tags:
        - builds
      operationId: postBuildsApprove
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IBuildApprovalResponse"
  /api/apps/{appId}/builds/{id}/screens:
    get:
      tags:
        - buildScreens
      operationId: getBuildScreensGetScreens
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IBuildScreenResponse"
    post:
      tags:
        - buildScreens
      operationId: postBuildScreensUploadScreen
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
        - in: path
          name: id
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                image:
                  $ref: "#/components/schemas/UploadedFile"
              required:
                - image
        required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/IBuildScreenCreateResponse"
                  - type: object
                    properties:
                      status:
                        type: string
                    required:
                      - status
  /api/apps/{appId}/builds/{id}/screens/{screenId}/image:
    get:
      tags:
        - buildScreens
      operationId: getBuildScreensGetScreenImage
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
        - in: path
          name: id
          schema:
            type: string
          required: true
        - in: path
          name: screenId
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema: {}
  /api/apps/{appId}/builds/{id}/screens/{screenId}/diff:
    get:
      tags:
        - buildScreens
      operationId: getBuildScreensGetScreenDiff
      parameters:
        - in: path
          name: appId
          schema:
            type: string
          required: true
        - in: path
          name: id
          schema:
            type: string
          required: true
        - in: path
          name: screenId
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema: {}
  /api/admin/vcs-integrations:
    get:
      tags:
        - vcsIntegrations
      operationId: getVcsIntegrationsIndex
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IVcsIntegrationListResponse"
    post:
      tags:
        - vcsIntegrations
      operationId: postVcsIntegrationsCreate
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IVcsIntegrationCreateInput"
        required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IVcsIntegrationListResponse"
  /api/admin/vcs-integrations/{id}:
    get:
      tags:
        - vcsIntegrations
      operationId: getVcsIntegrationsShow
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IVcsIntegrationDetailResponse"
    put:
      tags:
        - vcsIntegrations
      operationId: putVcsIntegrationsUpdate
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IVcsIntegrationUpdateInput"
        required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IVcsIntegrationListResponse"
    delete:
      tags:
        - vcsIntegrations
      operationId: deleteVcsIntegrationsDelete
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema: {}
  /api/admin/users:
    get:
      tags:
        - users
      operationId: getUsersIndex
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IUserListResponse"
  /api/admin/users/{id}:
    put:
      tags:
        - users
      operationId: putUsersUpdate
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IUserUpdateInput"
        required: true
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  isAdmin:
                    type: boolean
                required:
                  - id
                  - isAdmin
  /healthz:
    get:
      tags:
        - healthcheck
      operationId: getHealthcheckIndex
      responses:
        "200":
          description: ""
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                required:
                  - version
components:
  schemas:
    ISessionResponse:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        isAdmin:
          type: boolean
      required:
        - id
        - name
        - isAdmin
    ISessionProvider:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
      required:
        - id
        - name
    IOnboardingStatusResponse:
      type: object
      properties:
        isOnboarded:
          type: boolean
      required:
        - isOnboarded
    IGitLabConfig:
      type: object
      properties:
        url:
          type: string
        clientId:
          type: string
        clientSecret:
          type: string
      required:
        - url
        - clientId
        - clientSecret
    IOnboardingVcsIntegrationInput:
      type: object
      properties:
        name:
          type: string
        platform:
          type: string
          enum:
            - gitlab
            - github
        config:
          $ref: "#/components/schemas/IGitLabConfig"
      required:
        - name
        - platform
        - config
    PickVcsIntegrationEntity:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        platform:
          type: string
          enum:
            - gitlab
            - github
      required:
        - id
        - name
        - platform
    ISessionLoginRequest:
      type: object
      properties:
        providerId:
          type: string
        redirectUri:
          type: string
        code:
          type: string
      required:
        - providerId
        - redirectUri
        - code
    ISessionLoginResponse:
      type: object
      properties:
        jwt:
          type: string
      required:
        - jwt
    IAppIndexResponse:
      type: object
      properties:
        id:
          type: string
        defaultBranchId:
          type: string
        name:
          type: string
        buildCount:
          type: number
    IAppShowResponse:
      type: object
      properties:
        id:
          type: string
        vcsId:
          type: string
        projectPath:
          type: string
        vcsProjectId:
          nullable: true
          type: number
        defaultBranchId:
          type: string
        name:
          type: string
        deletedAt:
          nullable: true
          type: string
        commitUrlBase:
          nullable: true
          type: string
      required:
        - id
        - vcsId
        - projectPath
        - vcsProjectId
        - defaultBranchId
        - name
        - deletedAt
        - commitUrlBase
    IAppCreateInput:
      type: object
      properties:
        name:
          type: string
        vcsId:
          type: string
        projectPath:
          type: string
        vcsProjectId:
          type: number
        defaultBranchName:
          type: string
      required:
        - name
        - vcsId
        - projectPath
    IAppUpdateInput:
      type: object
      properties:
        name:
          type: string
        defaultBranchId:
          type: string
    IVcsProject:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        projectPath:
          type: string
        webUrl:
          type: string
        description:
          type: string
        defaultBranch:
          type: string
      required:
        - id
        - name
        - projectPath
        - webUrl
        - description
    IBranchResponse:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
      required:
        - id
        - name
    IBuildResponse:
      type: object
      properties:
        id:
          type: string
        branchId:
          type: string
        commitHash:
          type: string
        commitSubject:
          type: string
        commitAuthor:
          type: string
        createdAt:
          type: string
        status:
          type: string
          enum:
            - draft
            - processing
            - no changes
            - needs review
            - changes approved
            - canceled
            - failed
        branchName:
          type: string
      required:
        - id
        - branchId
        - commitHash
        - commitSubject
        - commitAuthor
        - createdAt
        - status
        - branchName
    IBuildBasicResponse:
      type: object
      properties:
        status:
          type: string
          enum:
            - draft
            - processing
            - no changes
            - needs review
            - changes approved
            - canceled
            - failed
      required:
        - status
    IBuildApprovalResponse:
      type: object
      properties:
        vcsUrl:
          oneOf:
            - type: string
            - type: boolean
              enum:
                - false
      required:
        - vcsUrl
    PickBuildScreenEntity:
      type: object
      properties:
        id:
          type: string
        buildId:
          type: string
        matchedBuildId:
          nullable: true
          type: string
        approvalBuildId:
          nullable: true
          type: string
        screenId:
          type: string
        status:
          type: string
          enum:
            - new
            - no changes
            - needs review
            - changes approved
            - null
          nullable: true
      required:
        - id
        - buildId
        - matchedBuildId
        - approvalBuildId
        - screenId
        - status
    IBuildScreenResponse:
      type: object
      properties:
        screenId:
          type: string
        name:
          type: string
        currentBuildScreen:
          $ref: "#/components/schemas/PickBuildScreenEntity"
        referenceBuildScreen:
          $ref: "#/components/schemas/PickBuildScreenEntity"
      required:
        - screenId
        - name
    UploadedFile:
      type: object
      properties:
        validator:
          nullable: true
        size:
          type: number
        path:
          type: string
        name:
          nullable: true
          type: string
        type:
          nullable: true
          type: string
        lastModifiedDate:
          nullable: true
          type: string
      required:
        - validator
        - size
        - path
        - name
        - type
        - lastModifiedDate
    IBuildScreenCreateResponse:
      type: object
      properties:
        id:
          type: string
        screenId:
          type: string
        status:
          type: string
          enum:
            - new
            - no changes
            - needs review
            - changes approved
            - null
          nullable: true
        name:
          type: string
      required:
        - id
        - screenId
        - status
        - name
    IVcsIntegrationListResponse:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        platform:
          type: string
          enum:
            - gitlab
            - github
      required:
        - id
        - name
        - platform
    IGitHubConfig:
      type: object
      properties:
        clientId:
          type: string
        clientSecret:
          type: string
      required:
        - clientId
        - clientSecret
    IVcsIntegrationDetailResponse:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        platform:
          type: string
          enum:
            - gitlab
            - github
        config:
          oneOf:
            - $ref: "#/components/schemas/IGitLabConfig"
            - $ref: "#/components/schemas/IGitHubConfig"
      required:
        - id
        - name
        - platform
        - config
    IVcsIntegrationCreateInput:
      type: object
      properties:
        name:
          type: string
        platform:
          type: string
          enum:
            - gitlab
            - github
        config:
          $ref: "#/components/schemas/IGitLabConfig"
      required:
        - name
        - platform
        - config
    IVcsIntegrationUpdateInput:
      type: object
      properties:
        name:
          type: string
        config:
          $ref: "#/components/schemas/IGitLabConfig"
    IUserListResponse:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        isAdmin:
          type: boolean
        createdAt:
          type: string
        lastLoginAt:
          type: string
        vcsName:
          type: string
      required:
        - id
        - name
        - isAdmin
        - createdAt
        - lastLoginAt
        - vcsName
    IUserUpdateInput:
      type: object
      properties:
        isAdmin:
          type: boolean
      required:
        - isAdmin
